/*! elasticui - v0.0.3 - 2014-07-21
 * http://www.elasticui.com
 * Copyright (c) 2014 Yousef El-Dardiry; Licensed Apache */

var elasticui;!function(a){!function(a){var b=function(){function b(){this.filters=[],this.jsonFilters=[]}return b.prototype.getFilterIndex=function(b){return this.jsonFilters.indexOf(a.EjsTool.getJsonFromEjsObject(b))},b.prototype.add=function(b){var c=this.getFilterIndex(b);-1==c&&(this.filters.push(b),this.jsonFilters.push(a.EjsTool.getJsonFromEjsObject(b)))},b.prototype.remove=function(a){var b=this.getFilterIndex(a);b>-1&&(this.filters.splice(b,1),this.jsonFilters.splice(b,1))},b.prototype.getAsFilter=function(){return a.FilterTool.combineFilters(this.filters)},b.prototype.getAsORFilter=function(){return a.FilterTool.combineFiltersShould(this.filters)},b.prototype.contains=function(a){return this.getFilterIndex(a)>-1},b}();a.FilterCollection=b}(a.util||(a.util={}));a.util}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){}return a.combineFilters=function(a){return 1===a.length?a[0]:a.length>1?ejs.BoolFilter().must(a):null},a.combineFiltersShould=function(a){return 1===a.length?a[0]:a.length>1?ejs.BoolFilter().should(a):null},a}();a.FilterTool=b}(a.util||(a.util={}));a.util}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){a.services=angular.module("elasticui.services",[])}(a.services||(a.services={}));a.services}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){a.directives=angular.module("elasticui.directives",[])}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="EAC",b.scope=!0,b.controller=a.controllers.AggregationController,b.link=function(a,b,c,d){var e=a.$eval(c.euiAggregation),f=a.$eval(c.euiFilterSelf);d.setFilterSelf(f),d.setAggregation(e)},b}return b}();b.AggregationDirective=c,b.directives.directive("euiAggregation",a.directives.AggregationDirective)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="A",b.scope=!0,b.controller=a.controllers.FilterController,b.link=function(a,b,c,d){a.$watch(b.attr("eui-filter")+" | euiCached",function(b){return a.filter.filter=b});var e=!1,f=b.attr("eui-enabled");f&&(a.$watch(f,function(b){return a.filter.enabled=b}),e=a.$eval(f)),a.filter={filter:a.$eval(b.attr("eui-filter")+" | euiCached"),enabled:e},d.init()},b}return b}();b.FilterDirective=c,b.directives.directive("euiFilter",c)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="EAC",b.scope=!1,b.controller=a.controllers.IndexController,b.link=function(a,b,c,d){a.$watch(c.euiIndex,function(a){d.indexVM.index=a}),d.indexVM.index=a.$eval(c.euiIndex)},b}return b}();b.IndexDirective=c,b.directives.directive("euiIndex",c)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){var a={};return a.require="ngModel",a.link=function(a,b,c,d){d.$parsers.push(function(a){return!a}),d.$formatters.push(function(a){return!a})},a}return a}();a.InvertedDirective=b,a.directives.directive("euiInverted",b)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="EAC",b.scope=!0,b.controller=a.controllers.OrFilterController,b.link=function(){},b}return b}();b.OrFilterDirective=c,b.directives.directive("euiOrFilter",c)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="A",b.scope=!0,b.controller=a.controllers.SortController,b.link=function(a,b,c,d){a.$watch(b.attr("eui-sort")+" | euiCached",function(b){return a.sorting.sort=b});var e=!1,f=b.attr("eui-enabled");f&&(a.$watch(f,function(b){return a.sorting.enabled=b}),e=a.$eval(f)),a.sorting={sort:a.$eval(b.attr("eui-sort")+" | euiCached"),enabled:e},d.init()},b}return b}();b.SortDirective=c,b.directives.directive("euiSort",c)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){var a={};return a.restrict="EAC",a.scope=!1,a.transclude=!1,a.link={pre:function(a,b){var c=b.attr("eui-key");a.$watch(b.attr("eui-value"),function(b,d){angular.equals(b,d)||(a[c]=b)},!0),a[c]=a.$eval(b.attr("eui-value"))}},a}return a.$inject=["$timeout"],a}();a.VarDirective=b,a.directives.directive("euiVar",b)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){a.filters=angular.module("elasticui.filters",[])}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){var a={};return function(b){if(!b)return b;var c=angular.toJson(b.toJSON());return a[c]||(a[c]=b),a[c]}}return a}();a.CachedFilter=b,a.filters.filter("euiCached",b)}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){return function(b,c){if(!b||!b.length)return b;var d=a.parseString(c);return b.map(function(b){return[b.key,a.getValue(b,d)]})}}return a.parseString=function(a){return a.split(".")},a.getValue=function(a,b){var c=a;return angular.forEach(b,function(a){return c?void(c=c[a]):c}),c},a}();a.MapFilter=b,a.filters.filter("euiMap",b)}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){return function(a,b,c,d){"undefined"==typeof d&&(d=5);for(var e=1;b>=e;e++)c+d>=e&&e>=c-d||c>e&&4>c-d||e>c+d&&4>b-(c+d)?a.push(e):1==e?a.push(1,-1):e==b&&a.push(-2,b);return a}}return a}();a.PageRangeFilter=b,a.filters.filter("euiPageRange",b)}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c);return a}}return a}();a.RangeFilter=b,a.filters.filter("euiRange",b)}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){return function(a){return a?Math.round(a):a}}return a}();a.RoundFilter=b,a.filters.filter("euiRound",b)}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){return function(a){return new Date(a).getTime()}}return a}();a.TimestampFilter=b,a.filters.filter("euiTimestamp",b)}(a.filters||(a.filters={}));a.filters}(elasticui||(elasticui={})),angular.module("elasticui.controllers",[]).controller(elasticui.controllers);var elasticui;!function(a){!function(b){var c=function(){function b(a){var b=this;this.filterSelf=!0,this.scope=a,a.$parent.$watch("indexVM.results",function(){return b.updateResults()})}return b.prototype.getAggName=function(){return Object.keys(this.agg.toJSON())[0]},b.prototype.updateResults=function(){var a=this.scope.indexVM.results;if(this.agg&&a&&a.aggregations){var b=this.getAggName(),c=Object.keys(a.aggregations).filter(function(a){return a==b||a=="filtered_"+b})[0],d=a.aggregations[c];c=="filtered_"+b&&(d=d[b]),this.scope.aggResult=d}},b.prototype.setFilterSelf=function(a){"undefined"==typeof a&&(a=!0),this.filterSelf=a},b.prototype.setAggregation=function(a){this.agg=a,this.scope.indexVM.addAggregationProvider(this)},b.prototype.getAggregation=function(b){var c=this,d=this.agg,e=b;this.filterSelf||(e=e.filter(function(a){return a!=c.scope.combinedFilter&&("undefined"==typeof a.field||a.field()!=c.agg.field())}));var f=a.util.FilterTool.combineFilters(e);return null!=f&&(d=new ejs.FilterAggregation("filtered_"+this.getAggName()).filter(f).agg(this.agg)),d},b.$inject=["$scope"],b}();b.AggregationController=c}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(a){this.scope=a}return b.prototype.init=function(){var b=this;if(this.scope.filter.filter){var c=this.scope.filters.contains(this.scope.filter.filter);!c&&this.scope.filter.enabled&&(this.scope.filters.add(this.scope.filter.filter),c=!0)}this.scope.filter.enabled=c,this.scope.$watch("filter.enabled",function(a,c){a!==c&&b.updateFilter()}),this.scope.$watch("filter.filter",function(c,d){a.util.EjsTool.equals(d,c)||(d&&b.scope.filters.remove(d),b.updateFilter())})},b.prototype.updateFilter=function(){this.scope.filter.filter&&(this.scope.filter.enabled?this.scope.filters.add(this.scope.filter.filter):this.scope.filters.remove(this.scope.filter.filter))},b.$inject=["$scope"],b}();b.FilterController=c}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(b,c,d,e){var f=this;this.aggregations=[],this.filters=new a.util.FilterCollection,this.indexVM={query:null,sort:null,highlight:null,loaded:!1,page:1,index:null,loading:!1,pageCount:0,pageSize:10,results:null,addAggregationProvider:function(a){return f.addAggregationProvider(a)},refresh:function(){return f.refreshIfDocCountChanged()}},this.searchPromise=null,this.refreshPromise=null,this.es=e,b.indexVM=this.indexVM,b.ejs=d.ejs,b.mainController=this,b.filters=this.filters,b.$watchCollection("filters.filters",function(){f.indexVM.page=1,f.search()}),b.$watch("indexVM.sort",function(){f.indexVM.page=1,f.search()}),b.$watch("indexVM.page",function(){return f.search()}),b.$watch("indexVM.index",function(){return f.search()}),b.$watch("indexVM.query",function(){return f.search()}),b.$watch("indexVM.highlight",function(){return f.search()}),c(function(){return f.loaded()},200)}return b.prototype.loaded=function(){this.indexVM.loaded||(this.indexVM.loaded=!0,this.search())},b.prototype.addAggregationProvider=function(a){this.aggregations.push(a),this.search()},b.prototype.getSearchPromise=function(){for(var a=ejs.Request(),b=0;b<this.aggregations.length;b++){var c=this.aggregations[b].getAggregation(this.filters.filters);a.agg(c)}var d=this.filters.getAsFilter();null!=d&&a.filter(d),a.query(null!=this.indexVM.query?this.indexVM.query:ejs.MatchAllQuery()),null!=this.indexVM.sort&&a.sort(this.indexVM.sort),null!=this.indexVM.highlight&&a.highlight(this.indexVM.highlight);var e=this.es.client.search({index:this.indexVM.index,size:this.indexVM.pageSize,from:this.indexVM.pageSize*(this.indexVM.page-1),body:a});return e},b.prototype.search=function(){var a=this;this.indexVM.loaded&&this.indexVM.index&&(null!=this.refreshPromise&&(this.refreshPromise.abort(),this.refreshPromise=null),this.indexVM.loading=!0,this.searchPromise=this.getSearchPromise(),this.searchPromise.then(function(b){a.searchPromise=null,a.onResult(b)}))},b.prototype.refreshIfDocCountChanged=function(){var a=this;this.indexVM.loaded&&this.indexVM.index&&null==this.searchPromise&&(this.indexVM.loading=!0,this.refreshPromise=this.getSearchPromise(),this.refreshPromise.then(function(b){a.refreshPromise=null,a.onResult(b,!0)}))},b.prototype.onResult=function(a,b){"undefined"==typeof b&&(b=!1),b&&null!=this.indexVM.results&&this.indexVM.results.hits.total==a.hits.total||(this.indexVM.results=a,this.indexVM.pageCount=Math.ceil(this.indexVM.results.hits.total/this.indexVM.pageSize)),this.indexVM.loading=!1},b.$inject=["$scope","$timeout","$window","es"],b}();b.IndexController=c}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(b){var c=this;this.filters=new a.util.FilterCollection,b.filters=this.filters,b.$watchCollection("filters.filters",function(){return c.updateCombinedFilter()}),this.scope=b}return b.prototype.updateCombinedFilter=function(){this.scope.combinedFilter&&this.scope.$parent.filters.remove(this.scope.combinedFilter),this.scope.combinedFilter=this.filters.getAsORFilter(),this.scope.combinedFilter&&this.scope.$parent.filters.add(this.scope.combinedFilter)},b.$inject=["$scope"],b}();b.OrFilterController=c}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(a){this.scope=a}return a.prototype.init=function(){var a=this;this.scope.$watch("indexVM.sort",function(){return a.updateEnabled()}),this.scope.$watch("sorting.sort",function(){return a.updateSort()}),this.scope.$watch("sorting.enabled",function(b,c){b!==c&&a.updateSort()}),this.updateSort()},a.prototype.updateSort=function(){this.scope.sorting.enabled?this.scope.indexVM.sort=this.scope.sorting.sort:this.isEnabledOnIndexScope()&&(this.scope.indexVM.sort=null)},a.prototype.updateEnabled=function(){this.scope.sorting.enabled=this.isEnabledOnIndexScope()},a.prototype.isEnabledOnIndexScope=function(){return null!=this.scope.indexVM.sort&&angular.equals(this.scope.indexVM.sort.toJSON(),this.scope.sorting.sort.toJSON())},a.$inject=["$scope"],a}();a.SortController=b}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(a,b){this.client=a({host:b})}return a.$inject=["esFactory","euiHost"],a}();a.ElasticService=b,a.services.service("es",b)}(a.services||(a.services={}));a.services}(elasticui||(elasticui={})),angular.module("elasticui",["elasticsearch","elasticui.filters","elasticui.controllers","elasticui.services","elasticui.directives","elasticui.widgets.directives"]);var elasticui;!function(a){!function(a){!function(a){a.directives=angular.module("elasticui.widgets.directives",[]),a.default_agg_count=0}(a.directives||(a.directives={}));a.directives}(a.widgets||(a.widgets={}));a.widgets}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){!function(b){var c=function(){function c(c){var d={};return d.restrict="E",d.scope=!0,d.link={pre:function(d,e,f){a.util.AngularTool.setupBinding(c,d,f,["field","size"]),d.agg_name=d.field.replace(/[^a-z_0-9]/gim,"_")+"_"+b.default_agg_count++}},d.template='            <ul class="nav nav-list" eui-aggregation="ejs.TermsAggregation(agg_name).field(field).size(size)">                <li ng-repeat="bucket in aggResult.buckets">                    <label class="checkbox" eui-filter="ejs.TermsFilter(field, bucket.key)">                        <input type="checkbox" ng-model="filter.enabled">                        {{bucket.key}} ({{bucket.doc_count}})                    </label>                </li>            </ul>',d}return c.$inject=["$parse"],c}();b.ChecklistDirective=c,b.directives.directive("euiChecklist",c)}(b.directives||(b.directives={}));b.directives}(a.widgets||(a.widgets={}));a.widgets}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){!function(a){var b=function(){function a(){var a={};return a.restrict="E",a.scope=!0,a.template='            <ul class="pager">                <li ng-class="{disabled:indexVM.page <= 1}"><a href="" ng-click="indexVM.page=indexVM.page - 1">Previous</a></li>                <li ng-class="{disabled:indexVM.pageCount <= indexVM.page}"><a href="" ng-click="indexVM.page=indexVM.page + 1">Next</a></li>            </ul>',a}return a}();a.SimplePagingDirective=b,a.directives.directive("euiSimplePaging",b)}(a.directives||(a.directives={}));a.directives}(a.widgets||(a.widgets={}));a.widgets}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){!function(b){var c=function(){function c(c){var d={};return d.restrict="E",d.scope=!0,d.link={pre:function(d,e,f){a.util.AngularTool.setupBinding(c,d,f,["field","size"]),d.agg_name=d.field.replace(/[^a-z_0-9]/gim,"_")+"_"+b.default_agg_count++}},d.template='            <ul class="nav nav-list" eui-aggregation="ejs.TermsAggregation(agg_name).field(field).size(size)">                <li ng-repeat="bucket in aggResult.buckets">                    <label eui-filter="ejs.TermsFilter(field, bucket.key)">                        <span ng-if="!filter.enabled"><a href="" ng-click="filter.enabled=true">{{bucket.key}} <span class="muted">({{bucket.doc_count}})</span></a></span>                        <span ng-if="filter.enabled">{{bucket.key}} <a href="" ng-click="filter.enabled=false" class="facet-remove">x</a></span>                    </label>                </li>            </ul>',d}return c.$inject=["$parse"],c}();b.SingleselectDirective=c,b.directives.directive("euiSingleselect",c)}(b.directives||(b.directives={}));b.directives}(a.widgets||(a.widgets={}));a.widgets}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(a){this.scope=a}return a.prototype.init=function(){var a=this;this.scope.$watch("indexVM.highlight",function(){return a.updateEnabled()}),this.scope.$watch("highlighting.highlight",function(){return a.updateHighlight()}),this.scope.$watch("highlighting.enabled",function(){return a.updateHighlight()}),this.updateHighlight()},a.prototype.updateHighlight=function(){this.scope.highlighting.enabled&&(this.scope.indexVM.highlight=this.scope.highlighting.highlight)},a.prototype.updateEnabled=function(){this.scope.highlighting.enabled=null!=this.scope.indexVM.highlight&&angular.equals(this.scope.indexVM.highlight.toJSON(),this.scope.highlighting.highlight.toJSON())},a.$inject=["$scope"],a}();a.HighlightController=b}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(a){this.scope=a}return b.prototype.init=function(){var b=this;this.scope.$watch("query.enabled",function(a,c){a!==c&&b.updateQuery()}),this.scope.$watch("query.query",function(c,d){a.util.EjsTool.equals(d,c)||b.updateQuery()}),this.updateQuery()},b.prototype.updateQuery=function(){this.scope.query.query&&(this.scope.indexVM.query=this.scope.query.enabled?this.scope.query.query:null)},b.$inject=["$scope"],b}();b.QueryController=c}(a.controllers||(a.controllers={}));a.controllers}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="A",b.scope=!0,b.controller=a.controllers.HighlightController,b.link=function(a,b,c,d){a.$watch(b.attr("eui-highlight")+" | euiCached",function(b){return a.highlighting.highlight=b});var e=!1,f=b.attr("eui-enabled");f&&(a.$watch(f,function(b){return a.highlighting.enabled=b}),e=a.$eval(f)),a.highlighting={highlight:a.$eval(b.attr("eui-highlight")+" | euiCached"),enabled:e},d.init()},b}return b}();b.HighlightDirective=c,b.directives.directive("euiHighlight",c)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){var c=function(){function b(){var b={};return b.restrict="A",b.scope=!0,b.controller=a.controllers.QueryController,b.link=function(a,b,c,d){a.$watch(b.attr("eui-query")+" | euiCached",function(b){return a.query.query=b});var e=!1,f=b.attr("eui-enabled");f&&(a.$watch(f,function(b){return a.query.enabled=b}),e=a.$eval(f)),a.query={query:a.$eval(b.attr("eui-query")+" | euiCached"),enabled:e},d.init()},b}return b}();b.QueryDirective=c,b.directives.directive("euiQuery",c)}(a.directives||(a.directives={}));a.directives}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){}return a.setupBinding=function(a,b,c,d){angular.forEach(d,function(d){b.$watch(c[d],function(a){b[d]!=a&&(b[d]=a)}),b[d]=a(c[d])(b)})},a}();a.AngularTool=b}(a.util||(a.util={}));a.util}(elasticui||(elasticui={}));var elasticui;!function(a){!function(a){var b=function(){function a(){}return a.getJsonFromEjsObject=function(a){return angular.toJson(a.toJSON())},a.equals=function(a,b){return!a&&!b||a&&b&&this.getJsonFromEjsObject(a)==this.getJsonFromEjsObject(b)},a}();a.EjsTool=b}(a.util||(a.util={}));a.util}(elasticui||(elasticui={}));var elasticui;!function(a){!function(b){!function(b){var c=function(){function b(b){var c={};return c.restrict="E",c.scope=!0,c.link={pre:function(c,d,e){a.util.AngularTool.setupBinding(b,c,e,["field"])}},c.template='            <input type="text" eui-query="ejs.MatchQuery(field, querystring)" ng-model="querystring" eui-enabled="querystring.length" />            ',c}return b.$inject=["$parse"],b}();b.SearchboxDirective=c,b.directives.directive("euiSearchbox",c)}(b.directives||(b.directives={}));b.directives}(a.widgets||(a.widgets={}));a.widgets}(elasticui||(elasticui={}));